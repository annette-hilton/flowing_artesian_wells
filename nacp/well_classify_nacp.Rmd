---
title: "NACP Project--Well Classification"
author: "Annette Hilton"
date: "05/03/2022"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, error = FALSE)
```

# Introduction

This project is an examination of early 1900s (~1890-1906) groundwater conditions in the North Atlantic Coastal Plain (NACP) as compared to present day (2010-2021).

The purpose of this Rmd is to:

1)  Determine well-aquifer classification
2)  Compare artesian conditions
  

## Attach Packages and Data 

```{r}
# Attach packages 

library(plyr) # Be sure to load `plyr()` first, otherwise other functions in tidyverse break! 
library(tidyverse)
library(here)
library(janitor)
library(naniar)
library(data.table)
library(knitr)

# Disable scientific notation 

options(scipen=999)
```

# Overview of North Atlantic Coastal Plain Aquifer System 

```{r, fig.cap= 'Figure 1. North Atlantic Coastal Plain Aquifer System aerial extent (Masterson et al., 2016)', fig.align='center', output.width= "200px", echo= FALSE}

knitr::include_graphics(here::here("images", "nacp_map.png"))

```

```{r, fig.cap= 'Figure 2. North Atlantic Coastal Plain Aquifer System aquifer units (Masterson et al., 2016)', fig.align='center', output.width= "200px", echo= FALSE}

knitr::include_graphics(here::here("images", "nacp_hydro.png"))

```

```{r, fig.cap= 'Figure 3. North Atlantic Coastal Plain Aquifer System hydrogeological GIS layers (Pope et al., 2016)', fig.align='center', output.width= "200px", echo= FALSE}

knitr::include_graphics(here::here("images", "nacp_hydro2.png"))

```

## ArcGIS Data Analysis

The following steps were performed in ArcGIS:

Hydrogeological data: Arcfile = "nacp_classify" (ArcPro)

1.  Hydrogeologic layers (raster files)
2.  Modern wells from NACP (USGS) (processed in Rmd
    `modern_data_cleaning.Rmd`) and early 1900s data
    (early1900s_dem_wgs84_final.txt)
3.  Use tool "Extract multi values to points" to determine well location
    intersection with geological raster layers
4.  Export resulting well data as a text files


### Hydrogeological data 

```{r}
# Read in modern data file from Arc 
# Rename columns 

nacp_mod_fromarc <- readr::read_csv(here::here("data", "nacp", "nacp_modern_classify.txt")) %>% 
  clean_names() %>% 
  rename(nacp_aq01s = nacp_aq01surf_1,
         nacp_cu01 = nacp_cu01_1, 
         nacp_aq02u = nacp_aq02upch_1, 
         nacp_cu02 = nacp_cu02_1, 
         nacp_aq03l = nacp_aq03loch_1,
         nacp_cu03 = nacp_cu03_1, 
         nacp_aq04p = nacp_aq04pipt_1, 
         nacp_cu04 = nacp_cu04_1, 
         nacp_aq05a = nacp_aq05aq_1, 
         nacp_cu05 = nacp_cu05_1, 
         nacp_aq06m = nacp_aq06moml_1,
         nacp_cu06 = nacp_cu06_1, 
         nacp_aq07m = nacp_aq07mtwn_1, 
         nacp_cu07 = nacp_cu07_1, 
         nacp_aq08m = nacp_aq08mgty_1, 
         nacp_cu08 = nacp_cu08_1, 
         nacp_aq09p = nacp_aq09popt_1, 
         nacp_cu09 = nacp_cu09_1, 
         nacp_aq10p = nacp_aq10popx_1, 
         nacp_cu10b = nacp_cu10bsmt_1)

# Read in early 1900s data file from Arc 
# Rename columns 

nacp_early1900s_fromarc <- readr::read_csv(here::here("data", "nacp", "nacp_1900s_classify.txt")) %>% 
  clean_names() %>% 
  rename(nacp_aq01s = nacp_aq01surf, 
         nacp_aq02u = nacp_aq02upch, 
         nacp_aq03l = nacp_aq03loch, 
         nacp_aq04p = nacp_aq04pipt, 
         nacp_aq05a = nacp_aq05aq, 
         nacp_aq06m = nacp_aq06moml, 
         nacp_aq07m = nacp_aq07mtwn, 
         nacp_aq08m = nacp_aq08mgty, 
         nacp_aq09p = nacp_aq09popt, 
         nacp_aq10p = nacp_aq10popx, 
         nacp_cu10b = nacp_cu10bsmt)

```

### NACP Aquifer Information 

Hydrogeologic Layer Surfaces:

- Surficial aquifer (nacp_aq01_surf) == (nacp_aq01s)
- Upper Chesapeake confining unit (nacp_cu01)
- Upper Chesapeake aquifer (nacp_aq02upch) == (nacp_aq02u)
- Lower Chesapeake confining unit (nacp_cu02)
- Lower Chesapeake aquifer (nacp_aq03loch) == (nacp_aq03l)
- Calvert confining unit (nacp_cu03)
- Piney Point aquifer (nacp_aq04pipt) == (nacp_aq04p)
- Nanjemoy-Marlboro confining unit (nacp_cu04)
- Aquia aquifer (nacp_aq05aq) == (nacp_aq05a)
- Monmouth-Mount Laurel confining unit (nacp_cu05)
- Monmouth-Mount Laurel aquifer (nacp_aq06moml) == (nacp_aq06m)
- Matawan confining unit (nacp_cu06)
- Matawan aquifer (nacp_aq07mtwn) == (nacp_aq07m)
- Magothy confining unit (nacp_cu07)
- Magothy aquifer (nacp_aq08mgty) == (nacp_aq08m)
- Potomac confining unit (nacp_cu08)
- Potomac-Patapsco aquifer (nacp_aq09popt) == (nacp_aq09p)
- Potomac-Patuxent confining unit (nacp_cu09)
- Potomac-Patuxent aquifer (nacp_aq10_popx) == (nacp_aq10_p)
- Basement (nacp_cu10bsmt) == (nacp_cu10b)

Unit Range (ft): 

- Surficial aquifer: 481 (-308)
- Upper Chesapeake confining unit: 129 (-354) 
- Upper Chesapeake aquifer: 114 (-383)
- Lower Chesapeake confining unit: 150 (-850)
- Lower Chesapeake aquifer: 215 (-1007)
- Calvert confining unit: 236 (-1671)
- Piney Point aquifer: 92 (-1516)
- Nanjemoy-Marlboro confining unit: 233 (-1720)
- Aquia aquifer: 228 (-1323)
- Monmouth-Mount Laurel confining unit: 214 (-1981) 
- Monmouth-Mount Laurel aquifer: 143 (-2377) 
- Matawan confining unit: 118 (-2439)
- Matawan aquifer: 62 (-2501) 
- Magothy confining unit: 130 (-2532) 
- Magothy aquifer: 187 (-2995) 
- Potomac confining unit: 198 (-3380)
- Potomac-Patapsco aquifer: 229 (-3602) 
- Potomac-Patuxent confining unit: 408 (-5373)
- Potomac-Patuxent aquifer: 408 (-5373)
- Basement: 400 (-9031) 


### Aquifer analysis 

- Find well bottom 
- Remove observations that do not fall within NACP (all NAs) 

```{r}
# Add a column that is elevation minus well depth
# Add column to remove rows if nacp_aq01s:nacp_cu10b are all NAs (does not intersect with NACP) 

# Modern data 

nacp_analysis_mod <- nacp_mod_fromarc %>% 
  mutate(topo_ft = rastervalu * 3.28084) %>% 
  mutate(well_bottom = topo_ft - well_depth_va) %>% 
   mutate(keep = 
           ifelse(is.na(nacp_aq01s) & is.na(nacp_cu01) & is.na(nacp_aq02u) 
                  & is.na(nacp_cu02) & is.na(nacp_aq03l) & is.na(nacp_cu03)
                  & is.na(nacp_aq04p) & is.na(nacp_cu04) & is.na(nacp_aq05a)
                  & is.na(nacp_cu05) & is.na(nacp_aq06m) & is.na(nacp_cu06)
                  & is.na(nacp_aq07m) & is.na(nacp_cu07) & is.na(nacp_aq08m)
                  & is.na(nacp_cu08) & is.na(nacp_aq09p) & is.na(nacp_cu09) 
                  & is.na(nacp_aq10p) & is.na(nacp_cu10b), "NA", "keep")) %>% 
  filter(!keep == "NA")

# 1900s data 

nacp_analysis_1900 <- nacp_early1900s_fromarc %>% 
  mutate(topo_ft = ned10m_bilinear_cusa_albers102003 * 3.28084) %>% 
  mutate(well_bottom = topo_ft - well_depth_ft) %>% 
   mutate(keep = 
           ifelse(is.na(nacp_aq01s) & is.na(nacp_cu01) & is.na(nacp_aq02u) 
                  & is.na(nacp_cu02) & is.na(nacp_aq03l) & is.na(nacp_cu03)
                  & is.na(nacp_aq04p) & is.na(nacp_cu04) & is.na(nacp_aq05a)
                  & is.na(nacp_cu05) & is.na(nacp_aq06m) & is.na(nacp_cu06)
                  & is.na(nacp_aq07m) & is.na(nacp_cu07) & is.na(nacp_aq08m)
                  & is.na(nacp_cu08) & is.na(nacp_aq09p) & is.na(nacp_cu09) 
                  & is.na(nacp_aq10p) & is.na(nacp_cu10b), "NA", "keep")) %>% 
  filter(!keep == "NA")
  
```

#### Classify each well to an aquifer unit 

```{r}
# Code for assigning each well to an aquifer unit 
# Not elegant but currently works! 

# Modern data 

nacp_class_mod <- nacp_analysis_mod %>% 
  rowwise() %>%
  mutate(aquifer = 
        ifelse(well_bottom < topo_ft & well_bottom >= max(nacp_cu01, nacp_aq02u, nacp_cu02, 
                                                            nacp_aq03l, nacp_cu03, nacp_aq04p, 
                                                            nacp_cu04, nacp_aq05a, nacp_cu05, 
                                                            nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "surf", 
        ifelse(well_bottom < nacp_cu01 & well_bottom >= max(nacp_aq02u, nacp_cu02, 
                                                            nacp_aq03l, nacp_cu03, nacp_aq04p, 
                                                            nacp_cu04, nacp_aq05a, nacp_cu05, 
                                                            nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE),"nacp_cu01",
        ifelse(well_bottom < nacp_aq02u & well_bottom >= max(nacp_cu02, 
                                                            nacp_aq03l, nacp_cu03, nacp_aq04p, 
                                                            nacp_cu04, nacp_aq05a, nacp_cu05, 
                                                            nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_aq02u", 
        ifelse(well_bottom < nacp_cu02 & well_bottom >= max(nacp_aq03l, nacp_cu03, nacp_aq04p, 
                                                            nacp_cu04, nacp_aq05a, nacp_cu05, 
                                                            nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_cu02",
        ifelse(well_bottom < nacp_aq03l & well_bottom >= max(nacp_cu03, nacp_aq04p, 
                                                            nacp_cu04, nacp_aq05a, nacp_cu05, 
                                                            nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_aq03l", 
        ifelse(well_bottom < nacp_cu03 & well_bottom >= max(nacp_aq04p, 
                                                            nacp_cu04, nacp_aq05a, nacp_cu05, 
                                                            nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_cu03", 
        ifelse(well_bottom < nacp_aq04p & well_bottom >= max(nacp_cu04, nacp_aq05a, nacp_cu05, 
                                                            nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_aq04p",
        ifelse(well_bottom < nacp_cu04 & well_bottom >= max(nacp_aq05a, nacp_cu05, 
                                                            nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_cu04",
        ifelse(well_bottom < nacp_aq05a & well_bottom >= max(nacp_cu05, 
                                                            nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_aq05a",
        ifelse(well_bottom < nacp_cu05 & well_bottom >= max(nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_cu05", 
        ifelse(well_bottom < nacp_aq06m & well_bottom >= max(nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_aq06m",
        ifelse(well_bottom < nacp_cu06 & well_bottom >= max(nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_cu06",
        ifelse(well_bottom < nacp_aq07m & well_bottom >= max(nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_aq07m",
        ifelse(well_bottom < nacp_cu07 & well_bottom >= max(nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_cu07",
        ifelse(well_bottom < nacp_aq08m & well_bottom >= max(nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_aq08m",
        ifelse(well_bottom < nacp_cu08 & well_bottom >= max(nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_cu08",
        ifelse(well_bottom < nacp_aq09p & well_bottom >= max(nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_aq09p",
        ifelse(well_bottom < nacp_cu09 & well_bottom >= max(nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_cu09",
        ifelse(well_bottom < nacp_aq10p & well_bottom >= nacp_cu10b, "nacp_aq10p",
        ifelse(well_bottom < nacp_cu10b, "nacp_cu10b", NA)))))))))))))))))))))


# 1900 data 
nacp_class_1900 <- nacp_analysis_1900 %>% 
  rowwise() %>%
  mutate(aquifer = 
        ifelse(well_bottom < topo_ft & well_bottom >= max(nacp_cu01, nacp_aq02u, nacp_cu02, 
                                                            nacp_aq03l, nacp_cu03, nacp_aq04p, 
                                                            nacp_cu04, nacp_aq05a, nacp_cu05, 
                                                            nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "surf", 
        ifelse(well_bottom < nacp_cu01 & well_bottom >= max(nacp_aq02u, nacp_cu02, 
                                                            nacp_aq03l, nacp_cu03, nacp_aq04p, 
                                                            nacp_cu04, nacp_aq05a, nacp_cu05, 
                                                            nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE),"nacp_cu01",
        ifelse(well_bottom < nacp_aq02u & well_bottom >= max(nacp_cu02, 
                                                            nacp_aq03l, nacp_cu03, nacp_aq04p, 
                                                            nacp_cu04, nacp_aq05a, nacp_cu05, 
                                                            nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_aq02u", 
        ifelse(well_bottom < nacp_cu02 & well_bottom >= max(nacp_aq03l, nacp_cu03, nacp_aq04p, 
                                                            nacp_cu04, nacp_aq05a, nacp_cu05, 
                                                            nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_cu02",
        ifelse(well_bottom < nacp_aq03l & well_bottom >= max(nacp_cu03, nacp_aq04p, 
                                                            nacp_cu04, nacp_aq05a, nacp_cu05, 
                                                            nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_aq03l", 
        ifelse(well_bottom < nacp_cu03 & well_bottom >= max(nacp_aq04p, 
                                                            nacp_cu04, nacp_aq05a, nacp_cu05, 
                                                            nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_cu03", 
        ifelse(well_bottom < nacp_aq04p & well_bottom >= max(nacp_cu04, nacp_aq05a, nacp_cu05, 
                                                            nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_aq04p",
        ifelse(well_bottom < nacp_cu04 & well_bottom >= max(nacp_aq05a, nacp_cu05, 
                                                            nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_cu04",
        ifelse(well_bottom < nacp_aq05a & well_bottom >= max(nacp_cu05, 
                                                            nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_aq05a",
        ifelse(well_bottom < nacp_cu05 & well_bottom >= max(nacp_aq06m, nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_cu05", 
        ifelse(well_bottom < nacp_aq06m & well_bottom >= max(nacp_cu06, nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_aq06m",
        ifelse(well_bottom < nacp_cu06 & well_bottom >= max(nacp_aq07m, 
                                                            nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_cu06",
        ifelse(well_bottom < nacp_aq07m & well_bottom >= max(nacp_cu07, nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_aq07m",
        ifelse(well_bottom < nacp_cu07 & well_bottom >= max(nacp_aq08m, nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_cu07",
        ifelse(well_bottom < nacp_aq08m & well_bottom >= max(nacp_cu08, 
                                                            nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_aq08m",
        ifelse(well_bottom < nacp_cu08 & well_bottom >= max(nacp_aq09p, nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_cu08",
        ifelse(well_bottom < nacp_aq09p & well_bottom >= max(nacp_cu09, nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_aq09p",
        ifelse(well_bottom < nacp_cu09 & well_bottom >= max(nacp_aq10p, 
                                                            nacp_cu10b, na.rm = TRUE), "nacp_cu09",
        ifelse(well_bottom < nacp_aq10p & well_bottom >= nacp_cu10b, "nacp_aq10p",
        ifelse(well_bottom < nacp_cu10b, "nacp_cu10b", NA)))))))))))))))))))))

```


### Separate each aquifer/unit and confined

##### Modern Data

Just confining unit above

```{r}
# Confining unit criteria 
# Must have confining unit above to be considered a confined well 
# Can include confining units (except the uppermost) 

confined_criteria_mod <- nacp_class_mod %>% 
  rowwise() %>% 
  mutate(status = 
           ifelse(is.na(aquifer), NA,
           ifelse(aquifer %in% c("surf", "nacp_cu01"), "unconfined", 
           ifelse(aquifer == "nacp_aq02u" & !is.na(nacp_cu01), "confined",
           ifelse(aquifer == "nacp_cu02" & !is.na(nacp_cu01), "confined", 
           ifelse(aquifer == "nacp_aq03l" & (!is.na(nacp_cu01) | !is.na(nacp_cu02)), "confined",
           ifelse(aquifer == "nacp_cu03" & (!is.na(nacp_cu01) | !is.na(nacp_cu02)), "confined",
           ifelse(aquifer == "nacp_aq04p" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03)), "confined",
           ifelse(aquifer == "nacp_cu04" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03)), "confined", 
           ifelse(aquifer == "nacp_aq05a" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04)), "confined", 
           ifelse(aquifer == "nacp_cu05" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04)), "confined", 
           ifelse(aquifer == "nacp_aq06m" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05)), "confined",
           ifelse(aquifer == "nacp_cu06" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05)), "confined", 
           ifelse(aquifer == "nacp_aq07m" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05) | !is.na(nacp_cu06)), "confined",
           ifelse(aquifer == "nacp_cu07" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05) | !is.na(nacp_cu06)), "confined",
           ifelse(aquifer == "nacp_aq08m" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05) | !is.na(nacp_cu06) | !is.na(nacp_cu07)), "confined",
           ifelse(aquifer == "nacp_cu08" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05) | !is.na(nacp_cu06) | !is.na(nacp_cu07)), "confined",
           ifelse(aquifer == "nacp_aq09p" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05) | !is.na(nacp_cu06) | !is.na(nacp_cu07) 
                   |!is.na(nacp_cu08)), "confined",
           ifelse(aquifer == "nacp_cu09" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05) | !is.na(nacp_cu06) | !is.na(nacp_cu07) 
                   |!is.na(nacp_cu08)), "confined",
           ifelse(aquifer == "nacp_aq10p" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05) | !is.na(nacp_cu06) | !is.na(nacp_cu07) 
                   |!is.na(nacp_cu08) | !is.na(nacp_cu09)), "confined",
           ifelse(aquifer == "nacp_cu10b" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05) | !is.na(nacp_cu06) | !is.na(nacp_cu07) 
                   |!is.na(nacp_cu08) | !is.na(nacp_cu09)), "confined",
                  "unconfined")))))))))))))))))))))

summary_mod <- confined_criteria_mod %>% 
  count(status)
```

##### 1900 Data

Just confining unit above

```{r}
# Confining unit criteria 
# Must have confining unit above to be considered a confined well 
# Can include confining units (except the uppermost) 

confined_criteria_1900 <- nacp_class_1900 %>% 
  rowwise() %>% 
  mutate(status = 
           ifelse(is.na(aquifer), NA,
           ifelse(aquifer %in% c("surf", "nacp_cu01"), "unconfined", 
           ifelse(aquifer == "nacp_aq02u" & !is.na(nacp_cu01), "confined",
           ifelse(aquifer == "nacp_cu02" & !is.na(nacp_cu01), "confined", 
           ifelse(aquifer == "nacp_aq03l" & (!is.na(nacp_cu01) | !is.na(nacp_cu02)), "confined",
           ifelse(aquifer == "nacp_cu03" & (!is.na(nacp_cu01) | !is.na(nacp_cu02)), "confined",
           ifelse(aquifer == "nacp_aq04p" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03)), "confined",
           ifelse(aquifer == "nacp_cu04" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03)), "confined", 
           ifelse(aquifer == "nacp_aq05a" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04)), "confined", 
           ifelse(aquifer == "nacp_cu05" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04)), "confined", 
           ifelse(aquifer == "nacp_aq06m" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05)), "confined",
           ifelse(aquifer == "nacp_cu06" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05)), "confined", 
           ifelse(aquifer == "nacp_aq07m" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05) | !is.na(nacp_cu06)), "confined",
           ifelse(aquifer == "nacp_cu07" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05) | !is.na(nacp_cu06)), "confined",
           ifelse(aquifer == "nacp_aq08m" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05) | !is.na(nacp_cu06) | !is.na(nacp_cu07)), "confined",
           ifelse(aquifer == "nacp_cu08" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05) | !is.na(nacp_cu06) | !is.na(nacp_cu07)), "confined",
           ifelse(aquifer == "nacp_aq09p" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05) | !is.na(nacp_cu06) | !is.na(nacp_cu07) 
                   |!is.na(nacp_cu08)), "confined",
           ifelse(aquifer == "nacp_cu09" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05) | !is.na(nacp_cu06) | !is.na(nacp_cu07) 
                   |!is.na(nacp_cu08)), "confined",
           ifelse(aquifer == "nacp_aq10p" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05) | !is.na(nacp_cu06) | !is.na(nacp_cu07) 
                   |!is.na(nacp_cu08) | !is.na(nacp_cu09)), "confined",
           ifelse(aquifer == "nacp_cu10b" & (!is.na(nacp_cu01) | !is.na(nacp_cu02) | !is.na(nacp_cu03) |
                    !is.na(nacp_cu04) | !is.na(nacp_cu05) | !is.na(nacp_cu06) | !is.na(nacp_cu07) 
                   |!is.na(nacp_cu08) | !is.na(nacp_cu09)), "confined",
                  "unconfined")))))))))))))))))))))

summary_1900 <- confined_criteria_1900 %>% 
  count(status)

```

### Accuracy check with USGS Confined/Unconfined 

##### Modern data only 

```{r}
# Check to see accuracy of confined/unconfined 

nacp_modern_check <- confined_criteria_mod %>% 
  rowwise() %>% 
  mutate(check =
           ifelse(status == "confined" & code %in% c("Confined single aquifer", "Confined multiple aquifers"), "true_c", 
           ifelse(status == "confined" & is.na(code), "no_data_c", 
           ifelse(status == "confined" & code %in% c("Unconfined single aquifer", "Unconfined multiple aquifer"), "wrong_c", 
           ifelse(status == "unconfined" & is.na(code), "no_data_uc",
           ifelse(status == "unconfined" & code %in% c("Unconfined single aquifer", "Unconfined multiple aquifer"), "true_uc", 
           ifelse(status == "unconfined" & code %in% c("Confined single aquifer", "Confined multiple aquifers"), "wrong_uc", 
                                                  NA)))))))

# Summary 
summary_check <- nacp_modern_check %>% 
  group_by(check) %>% 
  count(check)

# Checked wrong data spatial spread in ArcGIS (commented out)

# Isolate wrong confined 

confined_wrong <- nacp_modern_check %>%
  filter(check == "wrong_c")

write_tsv(confined_wrong, here::here("output_data", "nacp", "confined_wrong.txt"))

```

Make table from summary of error/unconfined-confined checking --working on this, not complete 05/02/22

```{r}
error_table <- summary_check %>% 
  filter(!is.na(check)) %>%
  mutate(total_n = colSums(summary_check[,-1])) 

```

### Summary tables 

##### Modern Data 

```{r}
# Final summaries of "correct" data 

# Modern data

# Confined/unconfined and artesian by aquifer unit

summary_mod_final_art <- nacp_modern_check %>% 
  filter(!check %in% c("wrong_uc", "wrong_c")) %>% 
  group_by(aquifer, status, artesian) %>% 
  count(aquifer) %>% 
  filter(!is.na(status))

# Pivot wider 

mod_final_wide <- pivot_wider(summary_mod_final_art, 
                          names_from = c(status, artesian), 
                          values_from = n) %>% 
  mutate(total_n = rowSums(across(where(is.numeric)), na.rm = T)) %>% 
  mutate(total_c = rowSums(across(confined_0:confined_1), na.rm = T)) %>% 
  rowwise() %>% 
  mutate(per_c = (total_c / total_n) *100) %>% 
  mutate(per_art = (confined_1 / total_c) *100)

# Tidy the table 

mod_final_table <- mod_final_wide %>% 
  select(aquifer, total_n, total_c, per_c, confined_1, per_art, confined_0) %>% 
  replace(is.na(.), 0) %>% 
  mutate_if(is.numeric, round, digits = 2) %>% 
  unite(confined_wells, c("total_c", "per_c"), sep = "  |  ") %>% 
  unite(artesian_wells, c("confined_1", "per_art"), sep = "  |  ") %>% 
  rename("Aquifer Units" = "aquifer", 
         "N wells" = "total_n", 
         "Number of wells defined as confined" = "confined_wells", 
         "Artesian confined flowing wells" = "artesian_wells",
         "Not artesian" = "confined_0") 


# Write to file 
write_csv(mod_final_table, here::here("output_data", "nacp", "mod_final_table.txt"))
  
```

```{r echo = FALSE, results = 'asis'}

# Display knitted table 

kable(mod_final_table, caption = "Table 1. Modern (2010-2021) confined and artesian wells of the North Atlantic Coastal Plain")
```


##### 1900s Data 

```{r}
# 1900s data

# Confined/unconfined by aquifer unit 
summary_1900_final <- confined_criteria_1900 %>% 
  group_by(aquifer, status, artesian) %>% 
  count(aquifer) 

# Pivot wider 

early1900s_final_wide <- pivot_wider(summary_1900_final, 
                          names_from = c(status, artesian), 
                          values_from = n) %>% 
  mutate(total_n = rowSums(across(where(is.numeric)), na.rm = T)) %>% 
  rowwise() %>% 
  mutate(total_c = sum(c(confined_0, confined_1), na.rm = T)) %>% 
  mutate(per_c = (total_c / total_n) *100) %>% 
  mutate(per_art = (confined_1 / total_c) *100)

# Tidy the table 

early1900s_final_table <- early1900s_final_wide %>% 
  select(aquifer, total_n, total_c, per_c, confined_1, per_art, confined_0) %>% 
  replace(is.na(.), 0) %>% 
  mutate_if(is.numeric, round, digits = 2) %>% 
  unite(confined_wells, c("total_c", "per_c"), sep = "  |  ") %>% 
  unite(artesian_wells, c("confined_1", "per_art"), sep = "  |  ") %>% 
  rename("Aquifer Units" = "aquifer", 
         "N wells" = "total_n", 
         "Number of wells defined as confined" = "confined_wells", 
         "Artesian confined flowing wells" = "artesian_wells",
         "Not artesian" = "confined_0") 

# Write to file 
write_csv(early1900s_final_table, here::here("output_data", "nacp", "early1900s_final_table.txt"))

```


```{r echo = FALSE, results = 'asis'}

# Display knitted table 

kable(early1900s_final_table, caption = "Table 1. Early 1900s confined and artesian wells of the North Atlantic Coastal Plain")
```
### Visualization 

Confined and unconfined well depth 

```{r}
# Data frame for plots 
ggplot_modern <- nacp_modern_check %>% 
  filter(!check %in% c("wrong_c", "wrong_uc")) %>% 
  filter(!is.na(check))

# Violin plot comparing confined, unconfined and USGS data/no data 
ggplot(ggplot_modern, 
       aes(x = status, 
           y = well_depth_va, 
           fill = check)) + 
  geom_violin()

```

Can't figure out binning...how can this be so hard? (05/02/22) 

```{r}
# # Binned data frame (~10 m intervals)
# 
# ggplot_mod_bin <- ggplot_modern %>% 
#   ungroup() %>% 
#   mutate(depth_bin = dplyr::ntile(well_depth_va, 33)) %>% 
#   mutate(confined_num = ifelse(status == "unconfined", 0, 1)) %>% 
#   group_by(depth_bin) %>% 
#   add_count(depth_bin)
#   
# ggplot_mod_bin2 <- ggplot_modern %>% 
#   ungroup() %>% 
#   mutate(depth_bin = cut(well_depth_va, breaks = c(0, 33, 66, 99, ))
#          
# test <- ggplot_modern %>% 
#   ungroup() %>% 
#   mutate(depth_bin = 
#            case_when(well_depth_va <= 33 ~"1", 
#                      well_depth_va <= 66 ~"2", 
#                      well_depth_va <= 99 ~"3", 
#                      TRUE ~"NA"))
# 
# 
# 
# %>% 
#   mutate(confined_num = ifelse(status == "unconfined", 0, 1)) %>% 
#   group_by(depth_bin) %>% 
#   add_count(depth_bin)
# 
# breaks = seq(33 - )

```


#### Comparison of artesian conditions (confined wells only) 

1900 to 2010-2020


```{r}
# All aquifers that are confined by our criteria, excluding "incorrect" ones (Modern) with USGS correction 

# Modern wells 
nacp_confined_mod <- nacp_modern_check %>% 
  filter(check %in% c("true_c", "no_data_c")) %>% 
  mutate(artesian = 
           ifelse(median < 0, 1, 0))

# Write as tsv 
write_csv(nacp_confined_mod, here::here("output_data", "nacp", "nacp_confined_mod.txt"))

# 1900 data 
nacp_confined_1900 <- confined_criteria_1900 %>% 
  filter(status == "confined") 

# Write as tsv 
write_csv(nacp_confined_1900, here::here("output_data", "nacp", "nacp_confined_historical.txt"))

```

