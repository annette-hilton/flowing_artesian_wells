---
title: "Mississippi Embayment Project--Well Classification"
author: "Annette Hilton"
date: "04/28/2022"
output: html_docu/ment
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, error = FALSE)
```

# Introduction

This project is an examination of early 1900s (\~1890-1906) groundwater
conditions in the Mississippi Embayment (ME) as compared to present day
(2010-2021).

The purpose of this Rmd is to:

1)  Determine well-aquifer classification
2)  Compare artesian conditions

## Attach Packages and Data

```{r}
# Attach packages 

# library(plyr) # Be sure to load `plyr()` first, otherwise other functions in tidyverse break! 
library(tidyverse)
library(here)
library(janitor)
# library(naniar)

# Disable scientific notation 

options(scipen=999)
```

## ArcGIS Data Analysis

The following steps were performed in ArcGIS:

Hydrogeological data: Arcfile = "me_classify" (ArcPro)

1.  Hydrogeologic layers (raster files)
2.  Modern wells from ME (USGS) (processed in Rmd
    `modern_data_cleaning.Rmd`) and early 1900s data
    (early1900s_dem_wgs84_final.txt)
3.  Use tool "Extract multi values to points" to determine well location
    intersection with geological raster layers
4.  Export resulting well data as a text files

## Data Analysis (Post-Arc)

### Hydrogeological data

```{r}
# Read in modern data file from Arc 

me_mod_fromarc <- readr::read_csv(here::here("data", "me", "me_modern_classify.txt")) %>% 
  clean_names()

# Read in early 1900s data file from Arc 

early1900s_fromarc <- readr::read_csv(here::here("data", "me", "me_historical_classify.txt"), guess_max = 6653) %>% 
  clean_names()

```

### ME Aquifer Information

Hydrogeologic Model Layer Surfaces:

-   Mississippi river valley aquifer **mrva**
-   Vicksburg-Jackson Group confining unit (top) **(vkbg)**\
-   Upper Claiborne aquifer (top) **(ucaq)**
-   Middle Claiborne confining unit (top) **(mccu)**\
-   Middle Claiborne aquifer (top) **(mcaq)**
-   Lower Claiborne confining unit (top) **(lccu)**\
-   Lower Claiborne aquifer (top) **(lcaq)**
-   Middle Wilcox aquifer (top) **(mwaq)**
-   Lower Wilcox aquifer (top) **(lwaq)**
-   Midway confining unit (top) **(mdwy)**

Unit Range (ft):

-   mrva: unknown
-   vkbg: 566 (-364)
-   ucaq: 521 (-874)
-   mccu: 540 (-1461)
-   mcaq: 654 (-1659)
-   lccu: 614 (-2539)
-   lcaq: 616 (-3102)
-   mwaq: 632 (-3347)
-   lwaq: 555 (-2320)
-   mdwy: 553 (-6036)

### Aquifer analysis

-   Find well bottom
-   Find true water level

```{r}
# Convert `rastervalu` column from meters to feet (conversion: 1 meter = 3.28084 feet)
# Add a column that is elevation minus well depth
# Add a column that is elevation minus well water level 

# Modern data 

me_analysis_mod <- me_mod_fromarc %>% 
  mutate(topo_ft = rastervalu * 3.28084) %>% 
  mutate(well_bottom = topo_ft - well_depth_va) %>% 
  mutate(keep = 
           ifelse(is.na(vkbg_surf) & is.na(ucaq_surf) & is.na(mccu_surf) 
                  & is.na(mcaq_surf) & is.na(lccu_surf) & is.na(lcaq_surf)
                  & is.na(mwaq_surf) & is.na(lwaq_surf) & is.na(mdwy_surf), "NA", "keep")) %>% 
  filter(!keep == "NA")

 
# 1900 data 

me_analysis_1900 <- early1900s_fromarc %>% 
  mutate(topo_ft = ned10m_bilinear_cusa_albers102003 * 3.28084) %>% 
  mutate(well_bottom = topo_ft - well_depth_ft) %>% 
  mutate(keep = 
           ifelse(is.na(vkbg_surf_1) & is.na(ucaq_surf_1) & is.na(mccu_surf_1) 
                  & is.na(mcaq_surf_1) & is.na(lccu_surf_1) & is.na(lcaq_surf_1)
                  & is.na(mwaq_surf_1) & is.na(lwaq_surf_1) & is.na(mdwy_surf_1), "NA", "keep")) %>% 
  filter(!keep == "NA")

```

#### Classify each well to an aquifer unit

Process:

If well bottom is greater than second unit (top), then it falls within
the first unit (second unit top is the bottom of the first unit).

Theory:

well bottom \> vkbg (first unit) = mrva well bottom \> ucaq (second
unit) = vkbg (first unit) well bottom \> mccu (third unit) = ucaq
(second unit) well bottom \> mcaq (fourth unit) = mccu (third unit) well
bottom \> lccu (fifth unit) = mcaq (fourth unit) well bottom \> lcaq
(sixth unit) = lccu (fifth unit) well bottom \> mwaq (seventh unit) =
lcaq (sixth unit) well bottom \> lwaq (eigth unit) = mwaq (seventh unit)
well bottom \> mdwy (ninth unit) = lwaq (eigth unit) well bottom \< mdwy
(ninth unit) = mdwy (ninth unit)

Code:

well bottom \< topo_ft & well bottom \> max(vkbg:mdwy) = mrva well
bottom \< vkbg & well bottom \> max(ucaq:mdwy) = vkbg well bottom \<
ucaq & well bottom \> max(mccu:mdwy) = ucaq well bottom \< mccu & well
bottom \> max(mcaq:mdwy) = mccu well bottom \< mcaq & well bottom \>
max(lccu:mdwy) = mcaq well bottom \< lccu & well bottom \>
max(lcaq:mdwy) = lccu well bottom \< lcaq & well bottom \>
max(mwaq:mdwy) = lcaq well bottom \< mwaq & well bottom \>
max(lwaq:mdwy) = mwaq well bottom \< lwaq & well bottom \> mdwy = lwaq
well bottom \< mdwy = mdwy

```{r}
# Code for assigning each well to an aquifer unit 
# Not elegant but currently works! 

# Modern data 

me_class_mod <- me_analysis_mod %>% 
  rowwise() %>%
  mutate(aquifer = 
        ifelse(well_bottom < topo_ft & well_bottom > max(vkbg_surf, ucaq_surf, mccu_surf, 
                                                            mcaq_surf, lccu_surf, lcaq_surf,
                                                            mwaq_surf, lwaq_surf, mdwy_surf, 
                                                            na.rm = TRUE), "mrva", 
        ifelse(well_bottom < vkbg_surf & well_bottom > max(ucaq_surf, mccu_surf, 
                                                            mcaq_surf, lccu_surf,lcaq_surf,
                                                            mwaq_surf, lwaq_surf, mdwy_surf, 
                                                            na.rm = TRUE),"vkbg",
        ifelse(well_bottom < ucaq_surf & well_bottom > max(mccu_surf, 
                                                            mcaq_surf, lccu_surf,lcaq_surf,
                                                            mwaq_surf, lwaq_surf, mdwy_surf, 
                                                            na.rm = TRUE), "ucaq", 
        ifelse(well_bottom < mccu_surf & well_bottom > max(mcaq_surf, lccu_surf,lcaq_surf,
                                                            mwaq_surf, lwaq_surf, mdwy_surf, 
                                                            na.rm = TRUE), "mccu",
        ifelse(well_bottom < mcaq_surf & well_bottom > max(lccu_surf,lcaq_surf,
                                                            mwaq_surf, lwaq_surf, mdwy_surf, 
                                                            na.rm = TRUE), "mcaq", 
        ifelse(well_bottom < lccu_surf & well_bottom > max(lcaq_surf,
                                                            mwaq_surf, lwaq_surf, mdwy_surf, 
                                                            na.rm = TRUE), "lccu", 
        ifelse(well_bottom < lcaq_surf & well_bottom > max(mwaq_surf, lwaq_surf, mdwy_surf, 
                                                            na.rm = TRUE), "lcaq",
        ifelse(well_bottom < mwaq_surf & well_bottom > max(lwaq_surf, mdwy_surf, 
                                                            na.rm = TRUE), "mwaq",
        ifelse(well_bottom < lwaq_surf & well_bottom > mdwy_surf, "lwaq",
        ifelse(well_bottom < mdwy_surf, "mdwy", NA))))))))))) %>% 
  ungroup()


# 1900s data 

me_class_1900 <- me_analysis_1900 %>% 
  rowwise() %>%
  mutate(aquifer = 
        ifelse(well_bottom < topo_ft & well_bottom > max(vkbg_surf_1, ucaq_surf_1, mccu_surf_1, 
                                                            mcaq_surf_1, lccu_surf_1, lcaq_surf_1,
                                                            mwaq_surf_1, lwaq_surf_1, mdwy_surf_1, 
                                                            na.rm = TRUE), "mrva", 
        ifelse(well_bottom < vkbg_surf_1 & well_bottom > max(ucaq_surf_1, mccu_surf_1, 
                                                            mcaq_surf_1, lccu_surf_1, lcaq_surf_1,
                                                            mwaq_surf_1, lwaq_surf_1, mdwy_surf_1, 
                                                            na.rm = TRUE),"vkbg",
        ifelse(well_bottom < ucaq_surf_1 & well_bottom > max(mccu_surf_1, 
                                                            mcaq_surf_1, lccu_surf_1, lcaq_surf_1,
                                                            mwaq_surf_1, lwaq_surf_1, mdwy_surf_1, 
                                                            na.rm = TRUE), "ucaq", 
        ifelse(well_bottom < mccu_surf_1 & well_bottom > max(mcaq_surf_1, lccu_surf_1, lcaq_surf_1,
                                                            mwaq_surf_1, lwaq_surf_1, mdwy_surf_1,
                                                            na.rm = TRUE), "mccu",
        ifelse(well_bottom < mcaq_surf_1 & well_bottom > max(lccu_surf_1, lcaq_surf_1,
                                                            mwaq_surf_1, lwaq_surf_1, mdwy_surf_1, 
                                                            na.rm = TRUE), "mcaq", 
        ifelse(well_bottom < lccu_surf_1 & well_bottom > max(lcaq_surf_1,
                                                            mwaq_surf_1, lwaq_surf_1, mdwy_surf_1, 
                                                            na.rm = TRUE), "lccu", 
        ifelse(well_bottom < lcaq_surf_1 & well_bottom > max(mwaq_surf_1, lwaq_surf_1, mdwy_surf_1,
                                                            na.rm = TRUE), "lcaq",
        ifelse(well_bottom < mwaq_surf_1 & well_bottom > max(lwaq_surf_1, mdwy_surf_1, 
                                                            na.rm = TRUE), "mwaq",
        ifelse(well_bottom < lwaq_surf_1 & well_bottom > mdwy_surf_1, "lwaq",
        ifelse(well_bottom < mdwy_surf_1, "mdwy", NA))))))))))) %>% 
  ungroup()

```

Summary of wells per aquifer unit

```{r}
# Summary of wells per aquifer unit 

# Modern data 
summarymod_me <- me_class_mod %>% 
  group_by(aquifer) %>% 
  count(aquifer) 

checking <- me_class_mod %>% 
  filter(!is.na(code))


# 1900s data 

summary1900_me <- me_class_1900 %>% 
  group_by(aquifer) %>% 
  count(aquifer)

```

### Separate each aquifer/unit and confined

#### Modern Data

Just confining unit above

```{r}
# Confining unit criteria 
# Must have confining unit above to be considered a confined well 
# Can include confining units (except the uppermost, VKBG) 

confined_criteria_mod <- me_class_mod %>% 
  rowwise() %>% 
  mutate(status = 
           ifelse(is.na(aquifer), NA,
           ifelse(aquifer %in% c("mrva", "vkbg"), "unconfined", 
           ifelse(aquifer == "ucaq" & is.na(vkbg_surf), "unconfined",
           ifelse(aquifer == "mccu" & is.na(vkbg_surf), "unconfined", 
           ifelse(aquifer == "mcaq" & !is.na(mccu_surf) | !is.na(vkbg_surf), "confined",
           ifelse(aquifer == "lccu" & !is.na(mccu_surf) | !is.na(vkbg_surf), "confined",
           ifelse(aquifer == "lcaq" & !is.na(lccu_surf) | !is.na(mccu_surf) | !is.na(vkbg_surf), "confined",
           ifelse(aquifer == "mwaq" & !is.na(lccu_surf) | !is.na(mccu_surf) | !is.na(vkbg_surf), "confined", 
           ifelse(aquifer == "lwaq" & !is.na(lccu_surf) | !is.na(mccu_surf) | !is.na(vkbg_surf), "confined", 
           ifelse(aquifer == "mdwy" & !is.na(lccu_surf) | !is.na(mccu_surf) | !is.na(vkbg_surf), "confined", "unconfined")))))))))))
```

#### 1900 Data

Just confining unit above

```{r}
# Confining unit criteria 
# Must have confining unit above to be considered a confined well 
# Can include confining units (except the uppermost, VKBG) 

confined_criteria_1900 <- me_class_1900 %>% 
  rowwise() %>% 
  mutate(status = 
           ifelse(is.na(aquifer), NA,
           ifelse(aquifer %in% c("mrva", "vkbg"), "unconfined", 
           ifelse(aquifer == "ucaq" & is.na(vkbg_surf_1), "unconfined",
           ifelse(aquifer == "mccu" & is.na(vkbg_surf_1), "unconfined", 
           ifelse(aquifer == "mcaq" & !is.na(mccu_surf_1) | !is.na(vkbg_surf_1), "confined",
           ifelse(aquifer == "lccu" & !is.na(mccu_surf_1) | !is.na(vkbg_surf_1), "confined",
           ifelse(aquifer == "lcaq" & !is.na(lccu_surf_1) | !is.na(mccu_surf_1) | !is.na(vkbg_surf_1), "confined",
           ifelse(aquifer == "mwaq" & !is.na(lccu_surf_1) | !is.na(mccu_surf_1) | !is.na(vkbg_surf_1), "confined", 
           ifelse(aquifer == "lwaq" & !is.na(lccu_surf_1) | !is.na(mccu_surf_1) | !is.na(vkbg_surf_1), "confined", 
           ifelse(aquifer == "mdwy" & !is.na(lccu_surf_1) | !is.na(mccu_surf_1) | !is.na(vkbg_surf_1), "confined", "unconfined")))))))))))
```

### Accuracy check with USGS Confined/Unconfined 

#### Modern data only 

```{r}
# Check to see accuracy of confined/unconfined 

me_modern_check <- confined_criteria_mod %>% 
  rowwise() %>% 
  mutate(check =
           ifelse(status == "confined" & code %in% c("Confined single aquifer", "Confined multiple aquifers"), "true_c", 
           ifelse(status == "confined" & is.na(code), "no_data_c", 
           ifelse(status == "confined" & code %in% c("Unconfined single aquifer", "Unconfined multiple aquifer"), "wrong_c", 
           ifelse(status == "unconfined" & is.na(code), "no_data_uc",
           ifelse(status == "unconfined" & code %in% c("Unconfined single aquifer", "Unconfined multiple aquifer"), "true_uc", 
           ifelse(status == "unconfined" & code %in% c("Confined single aquifer", "Confined multiple aquifers"), "wrong_uc", 
                                                  NA)))))))

# Summary 
summary_check <- me_modern_check %>% 
  group_by(check) %>% 
  count(check)

# Isolate wrong confined 

confined_wrong <- me_modern_check %>% 
  filter(check == "wrong_c")

write_tsv(confined_wrong, here::here("output_data", "me", "confined_wrong.txt"))

```

```{r}
# All aquifers that are confined by our criteria  
# Minus the incorrect ones 

# Modern data only USGS confirmed 
me_confined_mod <- me_modern_check %>% 
  filter(check == "true_c") %>% 
  mutate(artesian = 
           ifelse(median < 0, 1, 0))

# plus the other no data 
me_confined_mod_all <- me_modern_check %>% 
  filter(check %in% c("true_c", "no_data_c")) %>% 
  mutate(artesian = 
           ifelse(median < 0, 1, 0))

# Write as tsv 
write_csv(me_confined_mod, here::here("output_data", "me", "me_confined_mod.txt"))

# Write as tsv 
write_csv(me_confined_mod_all, here::here("output_data", "me", "me_confined_mod_all.txt"))

# 1900 data 
me_confined_1900 <- confined_criteria_1900 %>% 
  filter(status == "confined") 

# Write as tsv 
write_csv(me_confined_1900, here::here("output_data", "me", "me_confined_historical.txt"))

```

#### Comparison of artesian conditions

1900 to 2010-2020

Modern n = 143 1900s n = 386

```{r}
# MODERN 

# Modern all 
modern_roswell_all <- roswell_class_mod %>% 
  filter(!is.na(aquifer))

# write file for arc 
write_tsv(modern_roswell_all, here::here("output_data", "roswell", "modern_roswell_all.txt"))

# Modern alluvium 
modern_roswell_alluvium <- modern_roswell_all %>% 
  filter(aquifer == "alluvium") 

# write file for arc 
write_tsv(modern_roswell_alluvium, here::here("output_data", "roswell", "modern_roswell_alluvium.txt"))

# Modern artesia 
modern_roswell_artesia <- modern_roswell_all %>% 
  filter(aquifer == "artesia") 

# write file for arc 
write_tsv(modern_roswell_artesia, here::here("output_data", "roswell", "modern_roswell_artesia.txt"))


# 1900s 

# 1900s all 
historical_roswell_all <- roswell_class_1900 %>% 
  filter(!is.na(aquifer))

# write file for arc 
write_tsv(historical_roswell_all, here::here("output_data", "roswell", "historical_roswell_all.txt"))

# Historical alluvium 
historical_roswell_alluvium <- historical_roswell_all %>% 
  filter(aquifer == "alluvium") 

# write file for arc 
write_tsv(historical_roswell_alluvium, here::here("output_data", "roswell", "historical_roswell_alluvium.txt"))

# Historical artesia 
historical_roswell_artesia <- historical_roswell_all %>% 
  filter(aquifer == "artesia") 

# write file for arc 
write_tsv(historical_roswell_artesia, here::here("output_data", "roswell", "historical_roswell_artesia.txt"))
```
