---
title: "CV Project--Well Classification"
author: "Annette Hilton"
date: "05/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, error = FALSE)
```

# Introduction

This project is an examination of early 1900s (~1890-1906) groundwater conditions in the Southern Central Valley (CV) as compared to present day (2010-2021).

The purpose of this Rmd is to: 

*Pre-Rmd*: Data were processed in ArcGIS for DEM value 

1) Prep data for input to ArcGIS (for hydrogeological analysis) 
2) After ArcGIS processing: 

1) Determine well-aquifer classification 
2) Compare artesian conditions 
  

## Attach Packages and Data 

```{r}
# Attach packages 

library(tidyverse)
library(here)
library(janitor)
library(naniar)
library(knitr)
library(readr)

# Disable scientific notation 

options(scipen=999)
```


# Overview of Central Valley  

```{r, fig.cap= 'Figure 1. Central Valley aerial extent (Faunt, 2009)', fig.align='center', output.width= "200px", echo= FALSE}

knitr::include_graphics(here::here("images", "cv_aerial.png"))

```

```{r, fig.cap= 'Figure 2. Corcoran Clay aerial extent (Faunt, 2009)', fig.align='center', output.width= "200px", echo= FALSE}

knitr::include_graphics(here::here("images", "cv_clay.png"))

```

```{r, fig.cap= 'Figure 3. Hydrogeologic layers of the Central Valley (Faunt, 2009)', fig.align='center', output.width= "200px", echo= FALSE}

knitr::include_graphics(here::here("images", "cv_cross_section.png"))

```
## ArcGIS Data Analysis

The following steps were performed in ArcGIS:

Hydrogeological data: Arcfile = "cv_classify" (ArcPro)

1.  Hydrogeologic layers (raster files)
2.  Modern wells (USGS & CV Drilling wells) (processed in Rmd
    `modern_data_cleaning.Rmd`) and early 1900s data
    (early1900s_dem_wgs84_final.txt)
3.  Use tool "Extract multi values to points" to determine well location
    intersection with geological raster layers
4.  Export resulting well data as a text files

## Data Analysis (Post-Arc)

### Hydrogeological data

```{r}
# Read in modern data file from Arc 

na_values <- c("-9999", "-9999.0000000", "NA")

cv_mod_fromarc <- readr::read_csv(here::here("data", "cv", "cv_mod_classify.txt"), na = na_values) %>% 
  clean_names()
  

# Read in early 1900s data file from Arc 

early1900s_fromarc <- readr::read_csv(here::here("data", "cv", "cv_historical_classify.txt"), na = na_values) %>% 
  clean_names()

```

### CV Aquifer Information 

Hydrologic Model Layer Surfaces:

- Layer 4 (Top of Corcoran Clay) 
- Layer 5 (Corcoran Clay)
- Layer 6 (Bottom of Corcoran Clay)


### Aquifer analysis 

- Find well bottom 
- Remove observations that do not fall within aquifer system (all NAs) 

```{r}
# Convert `rastervalu` column from meters to feet (conversion: 1 meter = 3.28084 feet)
# Add a column that is elevation minus well depth
# Add a column that is elevation minus well water level 

# Modern data 

cv_analysis_mod <- cv_mod_fromarc %>% 
  mutate(topo_ft = rastervalu * 3.28084) %>% 
  mutate(well_bottom = topo_ft - well_depth_va) %>% 
   mutate(keep = 
           ifelse(is.na(layer1_top) & is.na(layer3_top) 
                  & is.na(layer4_top) & is.na(layer5_top) & is.na(layer6_top), "NA", "keep")) %>% 
  filter(!keep == "NA")

 
# 1900 data 

cv_analysis_1900 <- early1900s_fromarc %>% 
  mutate(topo_ft = ned10m_bilinear_cusa_albers102003 * 3.28084) %>% 
  mutate(well_bottom = topo_ft - well_depth_ft) %>% 
  mutate(keep = 
           ifelse(is.na(layer1_top) & is.na(layer3_top) 
                  & is.na(layer4_top) & is.na(layer5_top) & is.na(layer6_top), "NA", "keep")) %>% 
  filter(!keep == "NA") %>% 
  select(-oid)

```

#### Classify each well to an aquifer unit 


Process: 

If well bottom is greater than second unit (top), then it falls within the first unit (second unit top is the bottom of the first unit). 

Theory: 

well bottom > layer 4 (top of corcoran clay) = unconfined aquifer unit 
well bottom < layer 6 (bottom of corcoran clay) = confined aquifer unit

Code: 

well bottom < topo_ft & well bottom > max(layer4_top:layer6_top) = unconfined
well bottom < layer6_top = confined


```{r}
# Code for assigning each well to either confined or unconfined 

# Modern data 

cv_class_mod <- cv_analysis_mod %>% 
  rowwise() %>%
  mutate(aquifer = 
        ifelse(well_bottom < topo_ft & well_bottom > layer4_top, "unconfined", 
        ifelse(well_bottom < layer6_top, "confined", NA)))

# 1900 data 

cv_class_1900 <- cv_analysis_1900 %>% 
  rowwise() %>%
  mutate(aquifer = 
        ifelse(well_bottom < topo_ft & well_bottom > layer4_top, "unconfined", 
        ifelse(well_bottom < layer6_top, "confined", NA))) 

```




----------------------------------- 5/10/22 left off here -------------------------------------

```{r}
# confined only 1900 

cv_confined_1900_only <- cv_class_1900 %>% 
  filter(aquifer == "confined")

write_tsv(cv_confined_1900_only, here::here("output_data", "cv", "cv_conf_1900_only.txt"))
```

Summary of wells per aquifer unit 

```{r}
# Summary of wells per aquifer unit 

# Modern data 
summarymod_cv <- cv_class_mod %>% 
  group_by(aquifer) %>% 
  count(aquifer) 


# 1900s data 

summary1900_cv <- cv_class_1900 %>% 
  group_by(aquifer) %>% 
  count(aquifer)

# join summaries 

full_summary <- summary1900_cv %>% 
  full_join(summarymod_cv, by = "aquifer") %>% 
  rename(historical = n.x, 
         modern = n.y)
```

#### Confined Well Criteria 

Confined aquifer unit: 

- Criteria: Must have at least 10 m (33 ft) of confining material above
- Code: If the aquifer is confined, calculate the sum of the confining unit thickness above (layer4 & layer5). If the sum of the confining unit thickness is >= 33 ft (10m), then "keep" the well. 


First, determine thickness of aquifer units 

```{r}
# Thickness of corcoran clay

# Modern data 

cv_thickness_mod <- cv_class_mod %>% 
  mutate(
    corcoran_thick = layer4_top - layer6_top)

# 1900 data 

cv_thickness_1900 <- cv_class_1900 %>% 
  mutate(
    corcoran_thick = layer4_top - layer6_top)

```

Then, determine cumulative thickness & which wells meet criteria 

```{r}
# Modern data 

cv_cum_thickness_mod <- cv_thickness_mod %>% 
  rowwise() %>% 
  dplyr::mutate(keep = 
           ifelse(corcoran_thick >= 33, "keep", NA))

# Modern data 

cv_cum_thickness_1900 <- cv_thickness_1900 %>% 
  rowwise() %>% 
  dplyr::mutate(keep = 
           ifelse(corcoran_thick >= 33, "keep", NA))
```


### Separate each aquifer/unit and confined 

Confined aquifers 


```{r}
# All aquifers that are confined by our criteria  

# Modern data 

cv_confined_mod <- cv_cum_thickness_mod %>% 
  filter(keep == "keep" & aquifer == "confined") %>% 
  mutate(artesian = 
           ifelse(static_wat <= 0, 1, 0))

artesian_mod <- cv_confined_mod %>% 
  filter(artesian == 1)

# write file for arc 

write_tsv(cv_confined_mod, here::here("output_data", "cv", "modern_confined_cv.txt"))

# 1900 data 

cv_confined_1900 <- cv_cum_thickness_1900 %>% 
  filter(keep == "keep" & aquifer == "confined")

# write file for arc 

write_tsv(cv_confined_1900, here::here("output_data", "cv", "historical_confined_cv.txt"))

```



