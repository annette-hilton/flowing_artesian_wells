---
title: "Modern Well Records (~2010-2020)"
author: "Annette Hilton"
date: "11/15/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Continental USA modern data & analysis 

## Attach Packages

```{r}
# Attach packages 

library(tidyverse)
library(here)
library(janitor)
library(purrr)
library(dplyr)
library(tidyr)


# Disable scientific notation 

options(scipen=999)
```

### Read in Data

```{r}
# Read in the full dataset for all well water measurements for the USA 

entire_usa_gw <- readr::read_tsv(here::here("data", "entire_usa_2022.txt"))
```

### Tidy Data 

- Remove wells without well depth 
- Remove wells with zero depth 
- Remove wells without a water level 
- Keep records only from 2010 and later 
- Calculate median water level for that time period 
- Indicate artesian conditions
 
 
 2010-2021 
 
```{r}
usgs_modern <- entire_usa_gw %>% 
  filter(!well_depth_va == "NA") %>% 
  filter(!well_depth_va == 0.00) %>% 
  filter(!lev_dt == "NA") %>%
  filter(!is.na(lev_va)) %>% 
  filter(level_year >= 2010)
  

usgs_modern_med <- usgs_modern %>% 
  group_by(site_no) %>% 
  mutate(median = median(lev_va)) %>% 
  distinct(site_no, .keep_all = TRUE) %>% 
  mutate(artesian = ifelse(median <= 0, 1, 0)) %>% 
  select(site_no, dec_lat_va, dec_long_va, well_depth_va, median, level_date, level_year, id.x, artesian)

usgs_modern_med$site_no <- sub("^", "w", usgs_modern_med$site_no)

write_tsv(usgs_modern_med, here::here("output_data", "usgs_modern.txt"))
```

### Add DEM file and Confined/Unconfined USGS Definitions file  

```{r}
# Modern data 
# Read in modern USGS data w/ DEM 
dem_usgs_modern <- readr::read_csv(here::here("data", "dem", "dem_usgs_modern.csv"))

```
```{r}
# Modern data 
# USGS confined/unconfined definitions and aquifer designations
# Data obtained by Dr. Scott Jasechko 4/20/2022 

usgs_confined_unconf <- readr::read_tsv(here::here("data", "confined_unconf_usgs_fromscott.txt")) %>% 
  clean_names() %>% 
  filter(!code == "NaN") %>% 
  mutate(site_no = sub("^", "w", site_no)) %>% 
  distinct(site_no, .keep_all = TRUE)

# Second pull of confined/unconfined data (04/25/2022) 

usgs_confined_unconf_2 <- readr::read_csv(here::here("data", "usgs_c_uc_wells_042522.txt")) %>% 
  clean_names() %>% 
  rename(national_aquifer = national_a, 
         local_aquifer = local_aqui, 
         dec_long_va = dec_long_v)

# Tidy above file for join (fix the site_no) 

usgs_clean <- usgs_confined_unconf_2 %>% 
  separate(site_no, c("name", "site_no")) %>% 
  mutate(site_no = sub("^", "w", site_no)) %>% 
  distinct(site_no, .keep_all = TRUE)

```

```{r}
# Join the two confined unconfined files from USGS 

joined_c_uc <- usgs_clean %>% 
  full_join(usgs_confined_unconf, by = c("site_no", "code", "dec_lat_va", "dec_long_va")) %>% 
  distinct(site_no, .keep_all = TRUE)

# Tidy file 

joined_tidy <- joined_c_uc %>% 
  select(site_no, national_aquifer.x, local_aquifer.x, code, dec_lat_va, dec_long_va, depth_m.x)

```



```{r}
# Join DEM file

modern_intermediate <- usgs_modern_med %>% 
  full_join(dem_usgs_modern, by = "site_no")

# Join confined/unconfined definitions file 

modern_final <- modern_intermediate %>% 
  left_join(joined_tidy, by = "site_no") %>% 
  select(-dec_lat_va.y, -dec_long_va.y)

```

# Individual Aquifer Systems 

### Mississippi Embayment 

```{r}
# Missouri, Illinois, Kentucky, Tennessee, Arkansas, Mississippi, Alabama, Louisiana

me_modern <- modern_final %>% 
  filter(id.x %in% c("al", "ar", "il", "ky", "la", "ms", "mo", "tn"))

write_tsv(me_modern, here::here("data", "me", "me_modern.txt"))
```

### North Atlantic Coastal Plain 

```{r}
# New York, New Jersey, Delaware, Maryland, Virginia, North Carolina 

nacp_modern <- modern_final %>% 
  filter(id.x %in% c("ny", "nj", "de", "md", "va", "nc")) 

write_tsv(nacp_modern, here::here("data", "nacp", "nacp_modern.txt"))
```

### Central Valley (California) 

```{r}

```

### Floridan Aquifer System 

```{r}
# Florida, Georgia, South Carolina, Alabama

fl_modern <- modern_final %>% 
   filter(id.x %in% c("al", "fl", "ga", "sc")) 

write_tsv(fl_modern, here::here("data", "fl", "fl_modern.txt"))
```

### Texas Gulf Coast Aquifer System (Texas)

```{r}
# Texas

tx_modern <- modern_final %>% 
   filter(id.x == "tx") 

write_tsv(tx_modern, here::here("data", "tx", "tx_modern.txt"))
```

### Columbia Plateau (Washington State)

```{r}
# Washington State 

columbia_modern <- modern_final %>% 
   filter(id.x == "wa") 

write_tsv(columbia_modern, here::here("data", "columbia", "columbia_modern.txt"))
```

### Roswell Artesian Basin (New Mexico) 

```{r}
# New Mexico 

roswell_modern <- modern_final %>% 
   filter(id.x == "nm") 

write_tsv(roswell_modern, here::here("data", "roswell", "roswell_modern.txt"))
```

### Dakota Aquifer (South Dakota) 

```{r}
# usgs_sd <- entire_usa_gw %>% 
#   filter(id.x == "sd") %>% 
#   filter(!well_depth_va == "NA") %>% 
#   filter(!well_depth_va == 0.00) %>% 
#   filter(!lev_dt == "NA") %>%
#   filter(!is.na(lev_va)) 
# 
# usgs_sd$site_no <- sub("^", "w", usgs_sd$site_no)
# 
# write_tsv(usgs_sd, here::here("output_data", "sd", "usgs_sd.txt"))
# write_tsv(usgs_modern_med_sd, here::here("output_data", "sd", "usgs_modern_sd.txt"))

usgs_modern_med_sd <- modern_final %>% 
  filter(id.x == "sd")

write_tsv(usgs_modern_med_sd, here::here("data", "south_dakota", "usgs_modern_sd.txt"))

```

